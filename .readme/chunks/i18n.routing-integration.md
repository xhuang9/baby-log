---
last_verified_at: 2026-01-17T09:12:39Z
source_paths:
  - src/app/[locale]/layout.tsx
  - src/lib/i18n.ts
  - src/lib/i18n-routing.ts
  - src/lib/i18n-navigation.ts
  - src/config/app.ts
---

# Internationalization Routing Integration

> Status: active
> Last updated: 2026-01-17
> Owner: Core

## Purpose

Provide locale-aware routing using next-intl with a locale-first App Router structure and "as-needed" prefixes.

## Key Deviations from Standard

- **Locale segment routing**: Locale is provided via `[locale]` instead of middleware-based detection.
- **Root-only special routes**: `global-error.tsx`, `robots.ts`, and `sitemap.ts` live outside `[locale]` and are not localized.

## Architecture / Implementation

### Components
- `src/app/[locale]/layout.tsx` - Validates locale and sets request locale.
- `src/lib/i18n.ts` - Loads messages based on request locale.
- `src/lib/i18n-routing.ts` - Defines locale routing config.
- `src/lib/i18n-navigation.ts` - Exposes locale-aware navigation helpers.

### Data Flow
1. `generateStaticParams` prebuilds pages for all locales.
2. Root layout validates locale using `hasLocale` and calls `setRequestLocale`.
3. `getRequestConfig` loads the matching JSON message file.

### Code Pattern
```ts
const requested = await requestLocale;
const locale = hasLocale(routing.locales, requested)
  ? requested
  : routing.defaultLocale;
```

## Configuration

| Setting | Default | Description |
|---------|---------|-------------|
| `AppConfig.locales` | `['en']` | Supported locales for routing and translations.
| `AppConfig.defaultLocale` | `en` | Locale used when no match is found.
| `AppConfig.localePrefix` | `as-needed` | Default locale has no URL prefix.

## Gotchas / Constraints

- **Locale validation**: `setRequestLocale(locale)` is required for static rendering.
- **Non-localized root routes**: `robots.ts`, `sitemap.ts`, and `global-error.tsx` are not locale-prefixed.

## Testing Notes

- Request an invalid locale and confirm `notFound()` triggers.
- Add a temporary locale to `AppConfig.locales` and confirm `generateStaticParams` includes it.

## Related Systems

- `.readme/chunks/i18n.translation-workflow.md` - Translation file management.
- `.readme/chunks/architecture.route-structure.md` - Route group organization.
